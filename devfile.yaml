schemaVersion: 2.1.0
components:
  - name: gatsby
    container:
      image: quay.io/devfile/universal-developer-image:ubi8-latest
      mountSources: true
      memoryLimit: 2000Mi
      endpoints:
        - name: web
          targetPort: 8000
commands:
  - id: gatsby-develop
    exec:
      commandLine: "gatsby develop  -H 0.0.0.0"
      component: gatsby
      group:
        kind: run
    attributes:
      restart: "false"
  - id: setup-gatsby-cli
    exec:
      commandLine: "npm install -g gatsby-cli && npm install"
      component: gatsby
  - id: deploy
    composite:
      commands:
        - setup-gatsby-cli
        - gatsby-develop
      group:
        kind: deploy
        isDefault: true      
events:
  postStart:
    - setup-gatsby-cli
